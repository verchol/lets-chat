version: '1.0'
steps:


 setup-step:
    image:  node:latest
    fail-fast: false
    commands :
       - echo 'we are about to start'


 build-step:
     type: build
     dockerfile: Dockerfile
     image-name: verchol/lets-chat
     tag: codefesh

 push to registry:
     type: push
     candidate: ${{build-step}}
     tag: ${{CF_BRANCH}}


 unit-tests:
      image: ${{build-step}}
      fail-fast: false
      working-directory : ${{initial-clone}}
      commands:
        - npm test
        - echo $(date)

 after-build:
      image:  node:latest
      fail-fast: false
      commands :
         - echo 'after build'

 composition-step:
      type: composition
      composition: demo-chat-e2e
      composition-candidates:
        main:
          image: ${{build-step}}
          command: sleep 200 && curl http://app:5000/
